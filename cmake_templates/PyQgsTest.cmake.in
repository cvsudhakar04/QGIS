
SET(ENV{QGIS_PREFIX_PATH} "@QGIS_PYTEST_PREFIX_PATH@")
SET(ENV{@QGIS_PYTEST_PATH_VAR_NAME@} "@QGIS_PYTEST_LIBRARY_PATH@$ENV{QGIS_PYTEST_PATH_VAR_NAME}")
SET(ENV{PYTHONPATH} "@QGIS_PYTEST_PYTHONPATH@$ENV{PYTHONPATH}")

MESSAGE("export @QGIS_PYTEST_PATH_VAR_NAME@=$ENV{@QGIS_PYTEST_PATH_VAR_NAME@}")
MESSAGE("export PYTHONPATH=$ENV{PYTHONPATH}")

MESSAGE(STATUS "Running @PYTHON_TEST_WRAPPER_PROCESSED@ @Python_EXECUTABLE@ @QGIS_PYTEST_FILE_LOC@")
EXECUTE_PROCESS(
  COMMAND @PYTHON_TEST_WRAPPER_PROCESSED@ @Python_EXECUTABLE@ @QGIS_PYTEST_FILE_LOC@
  RESULT_VARIABLE import_res
)
# Pass the output back to ctest
IF(import_res)
  MESSAGE(FATAL_ERROR "Test failed: ${import_res}")
ENDIF(import_res)
